<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Magnolia Map â€” Secret Alphabet</title>
  <meta name="description" content="A living map of correspondences (Magnolia Tree) with Atlas UB's Circleâ†”Tree lens." />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="chrome">
    <header>
      <h1>Magnolia Map â€” Secret Alphabet</h1>
      <div class="toggles">
        <button id="togglePotential" aria-pressed="false">â­• Potential</button>
        <button id="toggleProjection" aria-pressed="true">ğŸŒ³ Projection</button>
        <label class="dial">Meaning
          <input type="range" id="meaningDial" min="0" max="1" step="0.05" value="0.4" />
        </label>
      </div>
    </header>

    <main>
      <div id="viz" aria-label="Magnolia tree visualization"></div>
      <aside id="panel" aria-live="polite">
        <h2 id="panel-title">Welcome</h2>
        <div id="panel-content">
          <p>Click a node to open layers. â­• shows latent links; the slider controls density.</p>
          <p class="credit-chip">Atlas UB â€” Unicode & Digital Metaphysics â€¢ Circleâ†”Tree lens</p>
        </div>
      </aside>
    </main>

    <footer>
      <small>Â© Lindsey Ryan Wiley & Atlas UB â€¢ Content CC BY-NC 4.0 â€¢ Code MIT</small>
    </footer>
  </div>

  <!-- Embedded dataset -->
  <script id="seeddata" type="application/json">
  {
    "nodes": [
      { "id": "magnolia", "label": "Magnolia", "glyph": "ğŸŒ¸", "children": ["root","trunk","branch","leaf","flower","fruit"],
        "layers": {"physical":"flowering tree, glossy leaves, seed cone","psychological":"calm nobility, grace","spiritual":"form unfolding from hidden seed"} },
      { "id": "root", "label": "Root", "glyph": "ğŸªµ", "layers": {"physical":"anchoring fibers","psychological":"security","spiritual":"truth drawing sustenance"} },
      { "id": "trunk", "label": "Trunk", "glyph": "ğŸªµ", "layers": {"physical":"central column","psychological":"character","spiritual":"unified channel"} },
      { "id": "branch", "label": "Branch", "glyph": "ğŸŒ¿", "layers": {"physical":"diverging conduits","psychological":"decisions","spiritual":"truths distributing love"} },
      { "id": "leaf", "label": "Leaf", "glyph": "ğŸƒ", "layers": {"physical":"sun-drinking surface","psychological":"attention","spiritual":"reception of light"} },
      { "id": "flower", "label": "Flower", "glyph": "ğŸŒº", "layers": {"physical":"bloom","psychological":"joy","spiritual":"truth made delightful"} },
      { "id": "fruit", "label": "Fruit", "glyph": "ğŸ", "layers": {"physical":"sweet vessel of seeds","psychological":"reward","spiritual":"goodness made useful"} }
    ]
  }
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>

  <script>
  (function(){
    const nodes = JSON.parse(document.getElementById('seeddata').textContent).nodes;
    const container = document.getElementById('viz');
    const panelTitle = document.getElementById('panel-title');
    const panelContent = document.getElementById('panel-content');
    const togglePotential = document.getElementById('togglePotential');
    const toggleProjection = document.getElementById('toggleProjection');
    const meaningDial = document.getElementById('meaningDial');
    const state = { potential:false, projection:true, meaning:parseFloat(meaningDial.value) };

    const svg = d3.select(container).append('svg').attr('viewBox','-420 -420 840 840');
    const gLinks = svg.append('g'); const gNodes = svg.append('g');

    function buildHierarchy(){
      const map = new Map(nodes.map(n=>[n.id,n]));
      const root = map.get("magnolia");
      return d3.hierarchy(root, n => (n.children||[]).map(id=>map.get(id)).filter(Boolean));
    }
    function point(d){ const r=d.y,a=d.x-Math.PI/2; return [Math.cos(a)*r,Math.sin(a)*r]; }
    const layout = d3.tree().size([2*Math.PI,340]);
    const root = layout(buildHierarchy());

    gLinks.selectAll('path').data(root.links()).enter().append('path')
      .attr('stroke','currentColor').attr('fill','none')
      .attr('d',d=>{ const [sx,sy]=point(d.source),[tx,ty]=point(d.target); return `M${sx},${sy}L${tx},${ty}`; });

    const nodeEnter = gNodes.selectAll('g').data(root.descendants()).enter().append('g')
      .attr('transform',d=>{const [x,y]=point(d);return`translate(${x},${y})`;})
      .style('cursor','pointer').on('click',(_,d)=>openPanel(d.data));
    nodeEnter.append('circle').attr('r',4).attr('fill','currentColor');
    nodeEnter.append('text').attr('dy','-0.6em').attr('text-anchor','middle').text(d=>d.data.label);

    function openPanel(node){
      panelTitle.textContent = (node.glyph||'')+' '+node.label;
      const L = node.layers||{}; panelContent.innerHTML = ['physical','psychological','spiritual']
        .map(k=>L[k]?`<div class="pill"><strong>${k}:</strong> ${L[k]}</div>`:'').join('');
    }
    openPanel(nodes[0]);
  })();
  </script>
</body>
</html>
